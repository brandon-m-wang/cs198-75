/**
 * @license uploadcare-widget v3.15.0
 *
 * Copyright (c) 2020 Uploadcare, Inc.
 *
 * This source code is licensed under the BSD 2-Clause License
 * found in the LICENSE file in the root directory of this source tree.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).uploadcare=t(e.$)}(this,(function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=t(e);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?m(e):t}function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=p(e);if(t){var r=p(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}function _(e,t,n){return(_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||w(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var k=function(){return"object"===("undefined"==typeof window?"undefined":r(window))},x=Object.freeze({__proto__:null,isWindowDefined:k});k()&&window.XDomainRequest&&n.default.ajaxTransport((function(e){var t;if(e.crossDomain&&e.async)return e.timeout&&(e.xdrTimeout=e.timeout,delete e.timeout),{send:function(n,i){function r(e,n,r,o){t.onload=t.onerror=t.ontimeout=function(){},t=void 0,i(e,n,r,o)}(t=new XDomainRequest).onload=function(){r(200,"OK",{text:t.responseText},"Content-Type: "+t.contentType)},t.onerror=function(){r(404,"Not Found")},t.onprogress=function(){},t.ontimeout=function(){r(0,"timeout")},t.timeout=e.xdrTimeout||Number.MAX_VALUE,t.open(e.type,e.url.replace(/^https?:/,"")),t.send(e.hasContent&&e.data||null)},abort:function(){t&&(t.onerror=function(){},t.abort())}}}));var S,C=k()&&!!(window.File&&window.FileList&&window.FileReader),T=k()&&!(!window.FormData||!C),U=k()&&("draggable"in(S=document.createElement("div"))||"ondragstart"in S&&"ondrop"in S),D=k()&&function(){var e;return!(!(e=document.createElement("canvas")).getContext||!e.getContext("2d"))}(),P=C&&U,j=null,I=k()&&/^[^(]+\(iP(?:hone|od|ad);\s*(.+?)\)/.exec(navigator.userAgent);if(I){var O=/OS (\d*)_(\d*)/.exec(I[1]);O&&(j=+O[1]+O[2]/10)}var E=k()&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),R=!1;try{k()&&new window.Blob&&(R=window.Blob)}catch(e){}var z=k()&&(window.URL||window.webkitURL||!1),F=z&&z.createObjectURL&&z,L=k()&&(null!=window.FileReader?window.FileReader.prototype.readAsArrayBuffer:void 0)&&window.FileReader,M=function(){var e;try{var t;return null!=(e=window.console)&&"function"==typeof e.log?(t=e).log.apply(t,arguments):void 0}catch(e){}},B=function(){var e;if(!(null!=(e=window.console)?e.debug:void 0))return M.apply(void 0,["Debug:"].concat(Array.prototype.slice.call(arguments)));try{var t;return(t=window.console).debug.apply(t,arguments)}catch(e){}},N=function(){var e;if(!(null!=(e=window.console)?e.warn:void 0))return M.apply(void 0,["Warning:"].concat(Array.prototype.slice.call(arguments)));try{var t;return(t=window.console).warn.apply(t,arguments)}catch(e){}},W={},K=function(e){if(null==W[e])return W[e]=!0,N(e)},q=[].indexOf,G=function(e){var t,n,i,r;for(r=[],n=0,i=e.length;n<i;n++)t=e[n],q.call(r,t)<0&&r.push(t);return r},X=function(e){return setTimeout(e,0)},J=function(e){var t,n;return t=!1,n=null,function(){return t||(n=e.apply(this,arguments),t=!0),n}},V=function(e){return n.default.Deferred().resolve(e).promise()},Y=function(e,t){var i;return i={},n.default.each(t,(function(t,r){var o=e[r];n.default.isFunction(o)?i[r]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=o.apply(e,n);return a===e?i:a}:i[r]=o})),i},$=function(e){return e.replace(/([A-Z])/g,"_$1").toUpperCase()},Q=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},H=/^(?:([^:/?#]+):)?(?:\/\/([^/?#]*))?([^?#]*)\??([^#]*)#?(.*)$/,Z=/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/i,ee=new RegExp("".concat(Z.source,"~[0-9]+"),"i"),te=new RegExp("^/?(".concat(Z.source,")(?:/(-/(?:[^/]+/)+)?([^/]*))?$"),"i"),ne=function(e){return te.exec(H.exec(e)[3])},ie=function(e){return e.replace(/[\\-\\[]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},re=function(e){var t;return"http:"!==(t=document.location.protocol)&&(t="https:"),e.replace(/^\/\//,t+"//").replace(/\/+$/,"")},oe=function(e,t,n){var i,r;return e[0]>t[0]||e[1]>t[1]||n?(r=t[0]/e[0],i=t[1]/e[1],!t[0]||t[1]&&r>i?[Math.round(i*e[0]),t[1]]:[t[0],Math.round(r*e[1])]):e.slice()},ae=["image/*","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"].join(","),se="B KB MB GB TB PB EB ZB YB".split(" "),ue={dataType:"json",crossDomain:!0,cache:!1},le=function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n.default.ajax(n.default.extend({url:e,type:t,data:i},r,ue)).then((function(e){var t,i;return e.error?("string"==typeof e.error?(t=e.error,i=e.error_code):(t=e.error.content,i=e.error.error_code),n.default.Deferred().reject({message:t,code:i})):e}),(function(t,n,i){var r;return r="".concat(n," (").concat(i,")"),N("JSONP unexpected error: ".concat(r," while loading ").concat(e)),r}))},ce=function(e,t,n,i){var r,o,a,s,u,l;if(window.HTMLCanvasElement.prototype.toBlob)return e.toBlob(i,t,n);for(a=(a=e.toDataURL(t,n)).split(","),o=window.atob(a[1]),r=new Uint8Array(o.length),s=u=0,l=o.length;u<l;s=u+=1)r[s]=o.charCodeAt(s);return i(new window.Blob([r],{type:/:(.+\/.+);/.exec(a[0])[1]}))},fe=function(e){var t,n,i;return i=0,t=[],n=function(){var e;return t.length?(e=t.shift(),X((function(){return e(n)}))):i-=1},function(r){return!e||i<e?(i+=1,X((function(){return r(n)}))):t.push(r)}},de=[["notify","progress",2],["resolve","done",0],["reject","fail",1]],pe=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return n.default.Deferred((function(t){return n.default.each(de,(function(r,o){var a;return a=n.default.isFunction(i[o[2]])&&i[o[2]],e[o[1]]((function(){var i;return(i=a&&a.apply(this,arguments))&&n.default.isFunction(i.promise)?i.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[o[0]+"With"](this===e?t.promise():this,a?[i]:arguments)}))}))})).promise()},he=55,me=110,ge=165,ve=255,_e="rgba(".concat(he,", ").concat(me,", ").concat(ge,", ").concat(ve/255,")");function ye(e,t){try{var n=[e-1,t-1,1,1],i=document.createElement("canvas");i.width=1,i.height=1;var r=document.createElement("canvas");r.width=e,r.height=t;var o=i.getContext("2d"),a=r.getContext("2d");a&&(a.fillStyle=_e,a.fillRect.apply(a,n),o.drawImage(r,e-1,t-1,1,1,0,0,1,1));var s=o&&o.getImageData(0,0,1,1).data,u=!1;return s&&(u=s[0]===he&&s[1]===me&&s[2]===ge&&s[3]===ve),r.width=r.height=1,u}catch(n){return M("Failed to test for max canvas size of ".concat(e,"x").concat(t,"."),n),!1}}function be(e,t){var n={};return function(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];var a=t(r,n);return a in n?n[a]:n[a]=e.apply(void 0,r)}}var we={squareSide:[Math.floor(Math.sqrt(5e6)),4096,8192,11180,10836,11402,14188,16384],dimension:[4096,8192,16384,32767,65535]},Ae=we.squareSide[we.squareSide.length-1];function ke(e){return function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];var o=n.default.Deferred();return X((function(){var t=e.apply(void 0,i);o.resolve(t)})),o.promise()}}function xe(e,t){for(var n=y(e,1)[0],i=Object.keys(t).map((function(e){return parseInt(e,10)})).sort((function(e,t){return e-t})),r=0;r<i.length;r++){var o=i[r],a=!!t[o];if(o>n&&a)return o;if(o<n&&!a)return o}return n}var Se=ke(be(ye,xe)),Ce=ke(be(ye,xe));function Te(e,t){var i=n.default.Deferred(),r=we.squareSide.find((function(n){return n*n>=e*t})),o=we.dimension.find((function(n){return n>=e&&n>=t}));if(!r||!o)return i.reject();var a=[Se(r,r),Ce(o,1)];return n.default.when.apply(n.default,a).done((function(e,t){e&&t?i.resolve():i.reject()})),i.promise()}var Ue,De,Pe,je,Ie,Oe,Ee,Re,ze,Fe,Le,Me,Be,Ne,We,Ke,qe,Ge,Xe,Je=[].indexOf;Ie={live:!0,manualStart:!1,locale:null,localePluralize:null,localeTranslations:null,systemDialog:!1,crop:!1,previewStep:!1,imagesOnly:!1,clearable:!1,multiple:!1,multipleMax:1e3,multipleMin:1,multipleMaxStrict:!1,imageShrink:!1,pathValue:!0,tabs:"file camera url facebook gdrive gphotos dropbox instagram evernote flickr onedrive",preferredTypes:"",inputAcceptTypes:"",doNotStore:!1,publicKey:null,secureSignature:"",secureExpire:"",pusherKey:"79ae88bd931ea68464d9",cdnBase:"https://ucarecdn.com",urlBase:"https://upload.uploadcare.com",socialBase:"https://social.uploadcare.com",previewProxy:null,previewUrlCallback:null,imagePreviewMaxSize:26214400,multipartMinSize:10485760,multipartPartSize:5242880,multipartMinLastPartSize:1048576,multipartConcurrency:4,multipartMaxAttempts:3,parallelDirectUploads:10,passWindowOpen:!1,cameraMirrorDefault:!0,enableAudioRecording:!0,enableVideoRecording:!0,videoPreferredMimeTypes:null,audioBitsPerSecond:null,videoBitsPerSecond:null,scriptBase:"//ucarecdn.com/widget/".concat("3.15.0","/uploadcare/"),debugUploads:!1,integration:""},qe={multipleMax:{from:0,to:1e3}},Pe={multipleMax:{min:1,max:1e3}},Be={tabs:{all:"file camera url facebook gdrive gphotos dropbox instagram evernote flickr onedrive box vk huddle",default:Ie.tabs}},Ne=k()&&(document.currentScript||(Xe=document.getElementsByTagName("script"))[Xe.length-1]),(Re=k()&&n.default(Ne).data("integration"))&&null!=Re&&(Ie=n.default.extend(Ie,{integration:Re})),We=function(e){return n.default.isArray(e)||(e=(e=n.default.trim(e))?e.split(" "):[]),e},Ue=function(e,t){var n,i,r,o,a,s,u,l,c=Object.prototype.hasOwnProperty;for(n=0,a=t.length;n<a;n++){if(o=t[n],l=u=We(e[o]),c.apply(Be,[o]))for(l=[],r=0,s=u.length;r<s;r++)i=u[r],c.apply(Be[o],[i])?l=l.concat(We(Be[o][i])):l.push(i);e[o]=G(l)}return e},Ge=function(e,t){var n,i,r;for(n=0,r=t.length;n<r;n++)null!=e[i=t[n]]&&(e[i]=re(e[i]));return e},Oe=function(e,t){var i,r,o,a;for(i=0,o=t.length;i<o;i++)null!=e[r=t[i]]&&("string"==typeof(a=e[r])?(a=n.default.trim(a).toLowerCase(),e[r]=!("false"===a||"disabled"===a)):e[r]=!!a);return e},Ee=function(e,t){var n,i,r;for(n=0,r=t.length;n<r;n++)null!=e[i=t[n]]&&(e[i]=parseInt(e[i]));return e},ze=function(e){return e._userAgent="UploadcareWidget/".concat("3.15.0","/").concat(e.publicKey," (JavaScript").concat(e.integration?"; ".concat(e.integration):"",")"),e},Ke=function(e,t){var n,i;for(n in t)i=t[n],null!=e[n]&&e[n]===i.from&&(e[n]=i.to);return e},De=function(e,t){var n,i,r;for(n in t){var o=t[n];r=o.min,i=o.max,null!=e[n]&&(e[n]=Math.min(Math.max(e[n],r),i))}return e},Le=function(e){var t;return{downscale:"x"===(t=/^([0-9]+)([x:])([0-9]+)\s*(|upscale|minimum)$/i.exec(n.default.trim(e.toLowerCase()))||[])[2],upscale:!!t[4],notLess:"minimum"===t[4],preferedSize:t.length?[+t[1],+t[3]]:void 0}},Me=function(e){var t=/^([0-9]+)x([0-9]+)(?:\s+(\d{1,2}|100)%)?$/i.exec(n.default.trim(e.toLowerCase()))||[];if(!t.length)return!1;var i=t[1]*t[2],r=Ae*Ae;return i>r?(K("Shrinked size can not be larger than ".concat(Math.floor(r/1e3/1e3),"MP. ")+"You have set ".concat(t[1],"x").concat(t[2]," (")+"".concat(Math.ceil(i/1e3/100)/10,"MP).")),!1):{quality:t[3]?t[3]/100:void 0,size:i}},je=function(e,t){var n,i,r,o;return this.previewProxy?(i=(r=!/\?/.test(this.previewProxy))||!/=$/.test(this.previewProxy),n=!r&&!/[&?=]$/.test(this.previewProxy),o=encodeURIComponent(e),i&&(o="url="+o),n&&(o="&"+o),r&&(o="?"+o),this.previewProxy+o):e},Fe=function(e){var t;return Ue(e,["tabs","preferredTypes","videoPreferredMimeTypes"]),Ge(e,["cdnBase","socialBase","urlBase","scriptBase"]),Oe(e,["doNotStore","imagesOnly","multiple","clearable","pathValue","previewStep","systemDialog","debugUploads","multipleMaxStrict","cameraMirrorDefault"]),Ee(e,["multipleMax","multipleMin","multipartMinSize","multipartPartSize","multipartMinLastPartSize","multipartConcurrency","multipartMaxAttempts","parallelDirectUploads"]),Ke(e,qe),De(e,Pe),ze(e),!1===e.crop||n.default.isArray(e.crop)||(/^(disabled?|false|null)$/i.test(e.crop)?e.crop=!1:n.default.isPlainObject(e.crop)?e.crop=[e.crop]:e.crop=n.default.map((""+e.crop).split(","),Le)),e.imageShrink&&!n.default.isPlainObject(e.imageShrink)&&(e.imageShrink=Me(e.imageShrink)),(e.crop||e.multiple)&&(e.previewStep=!0),T||(e.systemDialog=!1),e.validators&&(e.validators=e.validators.slice()),e.previewProxy&&!e.previewUrlCallback&&(e.previewUrlCallback=je),-1!==(t=e.tabs.indexOf("skydrive"))&&(e.tabs[t]="onedrive"),e};var Ve,Ye=function(){var e,t,n;for(e in t={},Ie)null!=(n=window["UPLOADCARE_".concat($(e))])&&(t[e]=n);return t},$e=J((function(e,t){var i;return t||(Ie=n.default.extend(Ie,Ye())),i=Fe(n.default.extend(Ie,e||{})),He.fire(i),i})),Qe=function(e){var t;return t=n.default.extend({},$e()),n.default.isEmptyObject(e)||(t=Fe(n.default.extend(t,e))),t},He=k()&&n.default.Callbacks("once memory"),Ze=function(){function e(){o(this,e),this.urls=[],this.styles=[]}return s(e,[{key:"addUrl",value:function(e){if(!/^https?:\/\//i.test(e))throw new Error("Embedded urls should be absolute. "+e);if(!(Je.call(this.urls,e)>=0))return this.urls.push(e)}},{key:"addStyle",value:function(e){return this.styles.push(e)}}]),e}(),et=function(e,t){var i;return i=n.default.Deferred(),t&&(e.src=t),e.complete?i.resolve(e):(n.default(e).one("load",(function(){return i.resolve(e)})),n.default(e).one("error",(function(){return i.reject(e)}))),i.promise()},tt=function e(t){return n.default.isArray(t)?n.default.when.apply(null,n.default.map(t,e)):t.src?et(t):et(new window.Image,t)},nt=function(){var e=n.default.Deferred();if(void 0!==Ve)e.resolve(Ve);else{var t=new window.Image;t.onload=function(){Ve=t.naturalWidth<t.naturalHeight,t.src="//:0",e.resolve(Ve)},t.src="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QA6RXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAYAAAEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAD/2wBDAP//////////////////////////////////////////////////////////////////////////////////////wAALCAABAAIBASIA/8QAJgABAAAAAAAAAAAAAAAAAAAAAxABAAAAAAAAAAAAAAAAAAAAAP/aAAgBAQAAPwBH/9k="}return e.promise()},it=function(e,t,i){var r=n.default.Deferred();return X((function(){try{var n=document.createElement("canvas"),o=n.getContext("2d");n.width=t,n.height=i,o.imageSmoothingQuality="high",o.drawImage(e,0,0,t,i),e.src="//:0",e.width=e.height=1,r.resolve(n)}catch(e){M("Failed to shrink image to size ".concat(t,"x").concat(i,"."),e),r.reject(e)}})),r.promise()},rt=function(e,t,i,r,o){var a=function(e,t,n,i){var r=[],o=t,a=n;do{r.push([o,a]),o=Math.round(o/i),a=Math.round(a/i)}while(o<e*i);return r.reverse()}(t,i,r,o),s=n.default.Deferred(),u=n.default.Deferred();u.resolve(e);var l,c=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=w(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(a);try{var f=function(){var e=y(l.value,2),r=e[0],o=e[1];u=u.then((function(e){var t=n.default.Deferred();return Te(r,o).then((function(){return t.resolve(e,!1)})).fail((function(){return t.resolve(e,!0)})),t.promise()})).then((function(e,t){return t?e:it(e,r,o)})).then((function(e){return s.notify((t-r)/(t-i)),e}))};for(c.s();!(l=c.n()).done;)f()}catch(e){c.e(e)}finally{c.f()}return u.done((function(e){s.resolve(e)})),u.fail((function(e){s.reject(e)})),s.promise()},ot=function(e,t){var i=n.default.Deferred();if(.71*e.width*e.height*.71<t.size)return i.reject("not required");var r=e.width,o=e.height,a=r/o,s=Math.floor(Math.sqrt(t.size*a)),u=Math.floor(t.size/Math.sqrt(t.size*a));return Te(s,u).fail((function(){i.reject("not supported")})).then((function(){("imageSmoothingQuality"in document.createElement("canvas").getContext("2d")&&!j&&!E?function(e,t,n){return it(e,t,n)}(e,s,u):rt(e,r,s,u,.71)).done((function(e){return i.resolve(e)})).progress((function(e){return i.notify(e)})).fail((function(){return i.reject("not supported")}))})),i.promise()},at=k()&&window.DataView,st=fe(1),ut=function(e,t){var i;return i=n.default.Deferred(),F&&at&&R?(st((function(r){var o;return i.always(r),(o=tt(F.createObjectURL(e))).always((function(e){return F.revokeObjectURL(e.src)})),o.fail((function(){return i.reject("not image")})),o.done((function(r){i.notify(.1);var a=n.default.when(ft(e),nt()).always((function(e,n){var s;return i.notify(.2),s="resolved"===a.state(),(o=ot(r,t)).progress((function(e){return i.notify(.2+.6*e)})),o.fail(i.reject),o.done((function(r){var a,u;return a="image/jpeg",u=t.quality||.8,!s&&mt(r)&&(a="image/png",u=void 0),ce(r,a,u,(function(t){return r.width=r.height=1,i.notify(.9),e?(n&&dt(e,1),(o=ct(t,225,[e.buffer])).done(i.resolve),o.fail((function(){return i.resolve(t)}))):i.resolve(t)}))})),null,null}));return a}))})),i.promise()):i.reject("support")},lt=function(e){var t,i,r,o,a;return a=function(e,n){var i;return(i=new L).onload=function(){return n(new at(i.result))},i.onerror=function(e){return t.reject("reader",e)},i.readAsArrayBuffer(e)},r=function(){return a(e.slice(i,i+128),(function(e){var t,n,r;for(t=n=0,r=e.byteLength;r>=0?n<r:n>r;t=r>=0?++n:--n)if(255===e.getUint8(t)){i+=t;break}return o()}))},o=function(){var n;return n=i,a(e.slice(i,i+=4),(function(o){var s,u;return 4!==o.byteLength||255!==o.getUint8(0)?t.reject("corrupted"):218===(u=o.getUint8(1))?t.resolve():(s=o.getUint16(2)-2,a(e.slice(i,i+=s),(function(e){return e.byteLength!==s?t.reject("corrupted"):(t.notify(n,s,u,e),r())})))}))},t=n.default.Deferred(),L&&at?(i=2,a(e.slice(0,2),(function(e){return 65496!==e.getUint16(0)?t.reject("not jpeg"):r()})),t.promise()):t.reject("support")},ct=function(e,t,i){var r,o,a,s;return r=n.default.Deferred(),a=[],o=[],(s=lt(e)).fail(r.reject),s.progress((function(e,n,i){if(i===t)return a.push(e),o.push(n)})),s.done((function(){var n,s,u,l,c,f,d,p,h;for(d=[e.slice(0,2)],l=0,f=i.length;l<f;l++)n=i[l],(u=new at(new ArrayBuffer(4))).setUint16(0,65280+t),u.setUint16(2,n.byteLength+2),d.push(u.buffer),d.push(n);for(p=2,s=c=0,h=a.length;h>=0?c<h:c>h;s=h>=0?++c:--c)a[s]>p&&d.push(e.slice(p,a[s])),p=a[s]+o[s]+4;return d.push(e.slice(p,e.size)),r.resolve(new R(d,{type:e.type}))})),r.promise()},ft=function(e){var t,i;return t=null,(i=lt(e)).progress((function(e,n,i,r){if(!t&&225===i&&r.byteLength>=14&&1165519206===r.getUint32(0)&&0===r.getUint16(4))return t=r})),i.then((function(){return t}),(function(e){return n.default.Deferred().reject(t,e)}))},dt=function(e,t){ht(e,(function(n,i){return e.setUint16(n,t,i)}))},pt=function(e){return ht(e,(function(t,n){return e.getUint16(t,n)}))},ht=function(e,t){var n,i,r,o;if(!e||e.byteLength<14||1165519206!==e.getUint32(0)||0!==e.getUint16(4))return null;if(18761===e.getUint16(6))i=!0;else{if(19789!==e.getUint16(6))return null;i=!1}if(42!==e.getUint16(8,i))return null;for(r=8+e.getUint32(10,i),n=0,o=e.getUint16(r-2,i);o>=0?n<o:n>o;o>=0?++n:--n){if(e.byteLength<r+10)return null;if(274===e.getUint16(r,i))return t(r+8,i);r+=12}return null},mt=function(e){var t,n,i,r,o,a;for(50,(t=document.createElement("canvas")).width=t.height=50,(n=t.getContext("2d")).drawImage(e,0,0,50,50),i=n.getImageData(0,0,50,50).data,t.width=t.height=1,r=o=3,a=i.length;o<a;r=o+=4)if(i[r]<254)return!0;return!1},gt=function(){function e(t,n){var i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};o(this,e),this.settings=n,this.sourceInfo=r,this.fileId=null,this.fileName=null,this.sanitizedName=null,this.fileSize=null,this.isStored=null,this.cdnUrlModifiers=null,this.isImage=null,this.imageInfo=null,this.mimeType=null,this.s3Bucket=null,(i=this.sourceInfo).source||(i.source=this.sourceName),this.__setupValidation(),this.__initApi()}return s(e,[{key:"__startUpload",value:function(){return n.default.Deferred().resolve()}},{key:"__completeUpload",value:function(){var e,t,n,i,r=this;return n=0,this.settings.debugUploads&&(B("Load file info.",this.fileId,this.settings.publicKey),t=setInterval((function(){return B("Still waiting for file ready.",n,r.fileId,r.settings.publicKey)}),5e3),this.apiDeferred.done((function(){return B("File uploaded.",n,r.fileId,r.settings.publicKey)})).always((function(){return clearInterval(t)}))),i=100,(e=function(){if("pending"===r.apiDeferred.state())return n+=1,r.__updateInfo().done((function(){return setTimeout(e,i),i+=50}))})()}},{key:"__updateInfo",value:function(){var e=this;return le("".concat(this.settings.urlBase,"/info/"),"GET",{jsonerrors:1,file_id:this.fileId,pub_key:this.settings.publicKey,wait_is_ready:+(null===this.isImage)},{headers:{"X-UC-User-Agent":this.settings._userAgent}}).fail((function(t){return e.settings.debugUploads&&M("Can't load file info. Probably removed.",e.fileId,e.settings.publicKey,t.message),e.__rejectApi("info",t)})).done(this.__handleFileData.bind(this))}},{key:"__handleFileData",value:function(e){if(this.fileName=e.original_filename,this.sanitizedName=e.filename,this.fileSize=e.size,this.isImage=e.is_image,this.imageInfo=e.image_info,this.mimeType=e.mime_type,this.isStored=e.is_stored,this.s3Bucket=e.s3_bucket,e.default_effects&&(this.cdnUrlModifiers="-/"+e.default_effects),this.s3Bucket&&this.cdnUrlModifiers&&this.__rejectApi("baddata"),this.__runValidators(),e.is_ready)return this.__resolveApi()}},{key:"__progressInfo",value:function(){var e;return{state:this.__progressState,uploadProgress:this.__progress,progress:"ready"===(e=this.__progressState)||"error"===e?1:.9*this.__progress,incompleteFileInfo:this.__fileInfo()}}},{key:"__fileInfo",value:function(){var e;return e=this.s3Bucket?"https://".concat(this.s3Bucket,".s3.amazonaws.com/").concat(this.fileId,"/").concat(this.sanitizedName):"".concat(this.settings.cdnBase,"/").concat(this.fileId,"/"),{uuid:this.fileId,name:this.fileName,size:this.fileSize,isStored:this.isStored,isImage:!this.s3Bucket&&this.isImage,originalImageInfo:this.imageInfo,mimeType:this.mimeType,originalUrl:this.fileId?e:null,cdnUrl:this.fileId?"".concat(e).concat(this.cdnUrlModifiers||""):null,cdnUrlModifiers:this.cdnUrlModifiers,sourceInfo:this.sourceInfo}}},{key:"__setupValidation",value:function(){if(this.validators=this.settings.validators||this.settings.__validators||[],this.settings.imagesOnly)return this.validators.push((function(e){if(!1===e.isImage)throw new Error("image")}))}},{key:"__runValidators",value:function(){var e,t,n,i,r,o,a;n=this.__fileInfo();try{for(r=this.validators,o=[],t=0,i=r.length;t<i;t++)a=r[t],o.push(a(n));return o}catch(t){return e=t,this.__rejectApi(e.message)}}},{key:"__initApi",value:function(){return this.apiDeferred=n.default.Deferred(),this.__progressState="uploading",this.__progress=0,this.__notifyApi()}},{key:"__notifyApi",value:function(){return this.apiDeferred.notify(this.__progressInfo())}},{key:"__rejectApi",value:function(e,t){return this.__progressState="error",this.__notifyApi(),this.apiDeferred.reject(e,this.__fileInfo(),t)}},{key:"__resolveApi",value:function(){return this.__progressState="ready",this.__notifyApi(),this.apiDeferred.resolve(this.__fileInfo())}},{key:"__cancel",value:function(){return this.__rejectApi("user")}},{key:"__extendApi",value:function(e){var t=this;return e.cancel=this.__cancel.bind(this),e.pipe=e.then=function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return t.__extendApi(pe.apply(void 0,[e].concat(i)))},e}},{key:"promise",value:function(){var e,t=this;return this.__apiPromise||(this.__apiPromise=this.__extendApi(this.apiDeferred.promise()),this.__runValidators(),"pending"===this.apiDeferred.state()&&((e=this.__startUpload()).done((function(){return t.__progressState="uploaded",t.__progress=1,t.__notifyApi(),t.__completeUpload()})),e.progress((function(e){if(e>t.__progress)return t.__progress=e,t.__notifyApi()})),e.fail((function(e){return t.__rejectApi("upload",e)})),this.apiDeferred.always(e.reject))),this.__apiPromise}}]),e}(),vt=null,_t=function(e){d(i,e);var t=v(i);function i(e){var n;return o(this,i),(n=t.apply(this,arguments)).__file=e,n.fileName=n.__file.name||"original",n.__notifyApi(),n}return s(i,[{key:"setFile",value:function(e){if(e&&(this.__file=e),this.sourceInfo.file=this.__file,this.__file)return this.fileSize=this.__file.size,this.fileType=this.__file.type||"application/octet-stream",this.settings.debugUploads&&B("Use local file.",this.fileName,this.fileType,this.fileSize),this.__runValidators(),this.__notifyApi()}},{key:"__startUpload",value:function(){var e,t,i,r=this;return this.apiDeferred.always((function(){return r.__file=null,r.__file})),this.__file.size>=this.settings.multipartMinSize&&R?(this.setFile(),this.multipartUpload()):(t=j,!this.settings.imageShrink||t&&t<8?(this.setFile(),this.directUpload()):(e=n.default.Deferred(),i=.4,ut(this.__file,this.settings.imageShrink).progress((function(t){return e.notify(t*i)})).done(this.setFile.bind(this)).fail((function(){return r.setFile(),i*=.1})).always((function(){return e.notify(i),r.directUpload().done(e.resolve).fail(e.reject).progress((function(t){return e.notify(i+t*(1-i))}))})),e))}},{key:"__autoAbort",value:function(e){return this.apiDeferred.fail(e.abort),e}},{key:"directRunner",value:function(e){return vt||(vt=fe(this.settings.parallelDirectUploads)),vt(e)}},{key:"directUpload",value:function(){var e,t=this;return e=n.default.Deferred(),this.__file?this.fileSize>104857600?(this.__rejectApi("size"),e):(this.directRunner((function(i){var r;if(e.always(i),"pending"===t.apiDeferred.state())return(r=new window.FormData).append("UPLOADCARE_PUB_KEY",t.settings.publicKey),r.append("signature",t.settings.secureSignature),r.append("expire",t.settings.secureExpire),r.append("UPLOADCARE_STORE",t.settings.doNotStore?"":"auto"),r.append("file",t.__file,t.fileName),r.append("file_name",t.fileName),r.append("source",t.sourceInfo.source),t.__autoAbort(n.default.ajax({xhr:function(){var t;return t=n.default.ajaxSettings.xhr(),t.upload&&t.upload.addEventListener("progress",(function(t){return e.notify(t.loaded/t.total)}),!1),t},crossDomain:!0,type:"POST",url:"".concat(t.settings.urlBase,"/base/?jsonerrors=1"),headers:{"X-UC-User-Agent":t.settings._userAgent},contentType:!1,processData:!1,data:r,dataType:"json",error:e.reject,success:function(n){if(null!=n?n.file:void 0)return t.fileId=n.file,e.resolve();if(n.error){var i=n.error,r=i.content,o=i.error_code;return e.reject({message:r,code:o})}return e.reject()}}))})),e):(this.__rejectApi("baddata"),e)}},{key:"multipartUpload",value:function(){var e,t=this;return e=n.default.Deferred(),this.__file?(this.multipartStart().done((function(n){return t.uploadParts(n.parts,n.uuid).done((function(){return t.multipartComplete(n.uuid).done((function(n){return t.fileId=n.uuid,t.__handleFileData(n),e.resolve()})).fail(e.reject)})).progress(e.notify).fail(e.reject)})).fail(e.reject),e):e}},{key:"multipartStart",value:function(){var e,t=this;return e={UPLOADCARE_PUB_KEY:this.settings.publicKey,signature:this.settings.secureSignature,expire:this.settings.secureExpire,filename:this.fileName,source:this.sourceInfo.source,size:this.fileSize,content_type:this.fileType,part_size:this.settings.multipartPartSize,UPLOADCARE_STORE:this.settings.doNotStore?"":"auto"},this.__autoAbort(le("".concat(this.settings.urlBase,"/multipart/start/?jsonerrors=1"),"POST",e,{headers:{"X-UC-User-Agent":this.settings._userAgent}})).fail((function(n){if(t.settings.debugUploads)return M("Can't start multipart upload.",n.message,e)}))}},{key:"uploadParts",value:function(e,t){var i,r,o,a,s,u,l,c,f,d,p=this;for(s=[],a=Date.now(),d=function(e,t){var n,r,o;if(s[e]=t,!(Date.now()-a<250)){for(a=Date.now(),o=0,n=0,r=s.length;n<r;n++)o+=t=s[n];return i.notify(o/p.fileSize)}},i=n.default.Deferred(),r=0,f=0,c=0,l=function(){var o,a,u,h,m;if(!(c>=p.fileSize))return u=c+p.settings.multipartPartSize,p.fileSize<u+p.settings.multipartMinLastPartSize&&(u=p.fileSize),a=p.__file.slice(c,u),c=u,h=f,r+=1,f+=1,o=0,(m=function(){if("pending"===p.apiDeferred.state())return s[h]=0,p.__autoAbort(n.default.ajax({xhr:function(){var e;return e=n.default.ajaxSettings.xhr(),e.responseType="text",e.upload&&e.upload.addEventListener("progress",(function(e){return d(h,e.loaded)}),!1),e},url:e[h],crossDomain:!0,type:"PUT",processData:!1,contentType:p.fileType,data:a,error:function(){return(o+=1)>p.settings.multipartMaxAttempts?(p.settings.debugUploads&&M("Part #".concat(h," and file upload is failed."),t),i.reject()):(p.settings.debugUploads&&B("Part #".concat(h,"(").concat(o,") upload is failed."),t),m())},success:function(){if(r-=1,l(),!r)return i.resolve()}}))})()},o=0,u=this.settings.multipartConcurrency;u>=0?o<u:o>u;u>=0?++o:--o)l();return i}},{key:"multipartComplete",value:function(e){var t,n=this;return t={UPLOADCARE_PUB_KEY:this.settings.publicKey,uuid:e},this.__autoAbort(le("".concat(this.settings.urlBase,"/multipart/complete/?jsonerrors=1"),"POST",t,{headers:{"X-UC-User-Agent":this.settings._userAgent}})).fail((function(t){if(n.settings.debugUploads)return M("Can't complete multipart upload.",e,n.settings.publicKey,t.message)}))}}]),i}(gt);_t.prototype.sourceName="local";var yt=function(e){d(i,e);var t=v(i);function i(e){var r;return o(this,i),(r=t.apply(this,arguments)).__input=e,r.fileId=Q(),r.fileName=n.default(r.__input).val().split("\\").pop(),r.__notifyApi(),r}return s(i,[{key:"__startUpload",value:function(){var e,t,i,r;return e=n.default.Deferred(),r="".concat(this.settings.urlBase,"/iframe/"),i="uploadcare--iframe-".concat(this.fileId),this.__iframe=n.default("<iframe>").attr({id:i,name:i}).css("display","none").appendTo("body").on("load",e.resolve).on("error",e.reject),t=function(e,t){return n.default("<input/>",{type:"hidden",name:e,value:t})},n.default(this.__input).attr("name","file"),this.__iframeForm=n.default("<form>").attr({method:"POST",action:r,enctype:"multipart/form-data",target:i}).append(t("UPLOADCARE_PUB_KEY",this.settings.publicKey)).append(t("UPLOADCARE_SIGNATURE",this.settings.secureSignature)).append(t("UPLOADCARE_EXPIRE",this.settings.secureExpire)).append(t("UPLOADCARE_FILE_ID",this.fileId)).append(t("UPLOADCARE_STORE",this.settings.doNotStore?"":"auto")).append(t("UPLOADCARE_SOURCE",this.sourceInfo.source)).append(this.__input).css("display","none").appendTo("body").submit(),e.always(this.__cleanUp.bind(this))}},{key:"__cleanUp",value:function(){var e,t;return null!=(e=this.__iframe)&&e.off("load error").remove(),null!=(t=this.__iframeForm)&&t.remove(),this.__iframe=null,this.__iframeForm=null,this.__iframeForm}}]),i}(gt);yt.prototype.sourceName="local-compat";var bt=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){
/*!
   * Pusher JavaScript Library v1.12.2
   * http://pusherapp.com/
   *
   * Copyright 2011, Pusher
   * Released under the MIT licence.
   */
var n=x.isWindowDefined;(function(){var e,t;(e=function(t,n){this.options=n||{},this.key=t,this.channels=new e.Channels,this.global_emitter=new e.EventsDispatcher;var i=this;this.checkAppKey(),this.connection=new e.Connection(this.key,this.options),this.connection.bind("connected",(function(){i.subscribeAll()})).bind("message",(function(e){var t,n=0===e.event.indexOf("pusher_internal:");e.channel&&(t=i.channel(e.channel))&&t.emit(e.event,e.data),n||i.global_emitter.emit(e.event,e.data)})).bind("disconnected",(function(){i.channels.disconnect()})).bind("error",(function(t){e.warn("Error",t)})),e.instances.push(this),e.isReady&&i.connect()}).instances=[],e.prototype={channel:function(e){return this.channels.find(e)},connect:function(){this.connection.connect()},disconnect:function(){this.connection.disconnect()},bind:function(e,t){return this.global_emitter.bind(e,t),this},bind_all:function(e){return this.global_emitter.bind_all(e),this},subscribeAll:function(){var e;for(e in this.channels.channels)this.channels.channels.hasOwnProperty(e)&&this.subscribe(e)},subscribe:function(e){var t=this,n=this.channels.add(e,this);return"connected"===this.connection.state&&n.authorize(this.connection.socket_id,this.options,(function(i,r){i?n.emit("pusher:subscription_error",r):t.send_event("pusher:subscribe",{channel:e,auth:r.auth,channel_data:r.channel_data})})),n},unsubscribe:function(e){this.channels.remove(e),"connected"===this.connection.state&&this.send_event("pusher:unsubscribe",{channel:e})},send_event:function(e,t,n){return this.connection.send_event(e,t,n)},checkAppKey:function(){null!==this.key&&void 0!==this.key||e.warn("Warning","You must pass your app key when you instantiate Pusher.")}},e.Util={extend:function e(t,n){for(var i in n)n[i]&&n[i].constructor&&n[i].constructor===Object?t[i]=e(t[i]||{},n[i]):t[i]=n[i];return t},stringify:function(){for(var e=["Pusher"],t=0;t<arguments.length;t++)"string"==typeof arguments[t]?e.push(arguments[t]):null==window.JSON?e.push(arguments[t].toString()):e.push(JSON.stringify(arguments[t]));return e.join(" : ")},arrayIndexOf:function(e,t){var n=Array.prototype.indexOf;if(null==e)return-1;if(n&&e.indexOf===n)return e.indexOf(t);for(i=0,l=e.length;i<l;i++)if(e[i]===t)return i;return-1}},e.debug=function(){e.log&&e.log(e.Util.stringify.apply(this,arguments))},e.warn=function(){if(window.console&&window.console.warn)window.console.warn(e.Util.stringify.apply(this,arguments));else{if(!e.log)return;e.log(e.Util.stringify.apply(this,arguments))}},e.VERSION="1.12.2",e.host="ws.pusherapp.com",e.ws_port=80,e.wss_port=443,e.channel_auth_endpoint="/pusher/auth",e.cdn_http="http://js.pusher.com/",e.cdn_https="https://d3dy5gmtp8yhk7.cloudfront.net/",e.dependency_suffix=".min",e.channel_auth_transport="ajax",e.activity_timeout=12e4,e.pong_timeout=3e4,e.isReady=!1,e.ready=function(){e.isReady=!0;for(var t=0,n=e.instances.length;t<n;t++)e.instances[t].connect()},function(){function t(){this._callbacks={}}function n(e){this.callbacks=new t,this.global_callbacks=[],this.failThrough=e}t.prototype.get=function(e){return this._callbacks[this._prefix(e)]},t.prototype.add=function(e,t){var n=this._prefix(e);this._callbacks[n]=this._callbacks[n]||[],this._callbacks[n].push(t)},t.prototype.remove=function(t,n){if(this.get(t)){var i=e.Util.arrayIndexOf(this.get(t),n);this._callbacks[this._prefix(t)].splice(i,1)}},t.prototype._prefix=function(e){return"_"+e},n.prototype.bind=function(e,t){return this.callbacks.add(e,t),this},n.prototype.unbind=function(e,t){return this.callbacks.remove(e,t),this},n.prototype.emit=function(e,t){for(var n=0;n<this.global_callbacks.length;n++)this.global_callbacks[n](e,t);var i=this.callbacks.get(e);if(i)for(n=0;n<i.length;n++)i[n](t);else this.failThrough&&this.failThrough(e,t);return this},n.prototype.bind_all=function(e){return this.global_callbacks.push(e),this},e.EventsDispatcher=n}(),function(){function t(e,t,n){void 0!==t[e]&&t[e](n)}function n(t,n,i){e.EventsDispatcher.call(this),this.state=void 0,this.errors=[],this.stateActions=i,this.transitions=n,this.transition(t)}n.prototype.transition=function(n,i){var r,o=this.state,a=this.stateActions;if(o&&-1==e.Util.arrayIndexOf(this.transitions[o],n))throw this.emit("invalid_transition_attempt",{oldState:o,newState:n}),new Error("Invalid transition ["+o+" to "+n+"]");t(o+"Exit",a,i),t(o+"To"+((r=n).substr(0,1).toUpperCase()+r.substr(1)),a,i),t(n+"Pre",a,i),this.state=n,this.emit("state_change",{oldState:o,newState:n}),t(n+"Post",a,i)},n.prototype.is=function(e){return this.state===e},n.prototype.isNot=function(e){return this.state!==e},e.Util.extend(n.prototype,e.EventsDispatcher.prototype),e.Machine=n}(),(t=function(){var t=this;e.EventsDispatcher.call(this),void 0!==window.addEventListener&&(window.addEventListener("online",(function(){t.emit("online",null)}),!1),window.addEventListener("offline",(function(){t.emit("offline",null)}),!1))}).prototype.isOnLine=function(){return void 0===window.navigator.onLine||window.navigator.onLine},e.Util.extend(t.prototype,e.EventsDispatcher.prototype),e.NetInfo=t,function(){var t={initialized:["waiting","failed"],waiting:["connecting","permanentlyClosed"],connecting:["open","permanentlyClosing","impermanentlyClosing","waiting"],open:["connected","permanentlyClosing","impermanentlyClosing","waiting"],connected:["permanentlyClosing","waiting"],impermanentlyClosing:["waiting","permanentlyClosing"],permanentlyClosing:["permanentlyClosed"],permanentlyClosed:["waiting","failed"],failed:["permanentlyClosed"]};function n(t){t.connectionWait=0,"flash"===e.TransportType?t.openTimeout=5e3:t.openTimeout=2e3,t.connectedTimeout=2e3,t.connectionSecure=t.compulsorySecure,t.connectionAttempts=0}function i(i,r){var o=this;function a(){o.connectionWait<1e4&&(o.connectionWait+=2e3),o.openTimeout<1e4&&(o.openTimeout+=2e3),o.connectedTimeout<1e4&&(o.connectedTimeout+=2e3),!0!==o.compulsorySecure&&(o.connectionSecure=!o.connectionSecure),o.connectionAttempts++}function s(){o._machine.transition("impermanentlyClosing")}function u(){o._activityTimer&&clearTimeout(o._activityTimer),o._activityTimer=setTimeout((function(){o.send_event("pusher:ping",{}),o._activityTimer=setTimeout((function(){o.socket.close()}),o.options.pong_timeout||e.pong_timeout)}),o.options.activity_timeout||e.activity_timeout)}function l(){o._machine.transition("open")}function c(e){var t,n,i=d(e);void 0!==i&&("pusher:connection_established"===i.event?o._machine.transition("connected",i.data.socket_id):"pusher:error"===i.event&&(t=i.data.code,n=i.data.message,o.emit("error",{type:"PusherError",data:{code:t,message:n}}),4e3===t?(o.compulsorySecure=!0,o.connectionSecure=!0,o.options.encrypted=!0,s()):t<4100?o._machine.transition("permanentlyClosing"):t<4200?(o.connectionWait=1e3,o._machine.transition("waiting")):t<4300?s():o._machine.transition("permanentlyClosing")))}function f(t){u();var n=d(t);if(void 0!==n){switch(e.debug("Event recd",n),n.event){case"pusher:error":o.emit("error",{type:"PusherError",data:n.data});break;case"pusher:ping":o.send_event("pusher:pong",{})}o.emit("message",n)}}function d(e){try{var t=JSON.parse(e.data);if("string"==typeof t.data)try{t.data=JSON.parse(t.data)}catch(e){if(!(e instanceof SyntaxError))throw e}return t}catch(t){o.emit("error",{type:"MessageParseError",error:t,data:e.data})}}function p(){o._machine.transition("waiting")}function h(e){o.emit("error",{type:"WebSocketError",error:e})}function m(t,n){var i=o.state;o.state=t,i!==t&&(e.debug("State changed",i+" -> "+t),o.emit("state_change",{previous:i,current:t}),o.emit(t,n))}e.EventsDispatcher.call(this),this.options=e.Util.extend({encrypted:!1},r),this.netInfo=new e.NetInfo,this.netInfo.bind("online",(function(){o._machine.is("waiting")&&(o._machine.transition("connecting"),m("connecting"))})),this.netInfo.bind("offline",(function(){o._machine.is("connected")&&(o.socket.onclose=void 0,o.socket.onmessage=void 0,o.socket.onerror=void 0,o.socket.onopen=void 0,o.socket.close(),o.socket=void 0,o._machine.transition("waiting"))})),this._machine=new e.Machine("initialized",t,{initializedPre:function(){o.compulsorySecure=o.options.encrypted,o.key=i,o.socket=null,o.socket_id=null,o.state="initialized"},waitingPre:function(){o.connectionWait>0&&o.emit("connecting_in",o.connectionWait),o.netInfo.isOnLine()&&o.connectionAttempts<=4?m("connecting"):m("unavailable"),o.netInfo.isOnLine()&&(o._waitingTimer=setTimeout((function(){o._machine.transition("connecting")}),function(){var e=o.connectionWait;if(0===e&&o.connectedAt){var t=(new Date).getTime()-o.connectedAt;t<1e3&&(e=1e3-t)}return e}()))},waitingExit:function(){clearTimeout(o._waitingTimer)},connectingPre:function(){if(!1===o.netInfo.isOnLine())return o._machine.transition("waiting"),void m("unavailable");var t=function(t,n){var i=e.ws_port,r="ws://";(n||"https:"===document.location.protocol)&&(i=e.wss_port,r="wss://");var o="flash"===e.TransportType?"true":"false";return r+e.host+":"+i+"/app/"+t+"?protocol=5&client=js&version="+e.VERSION+"&flash="+o}(o.key,o.connectionSecure);e.debug("Connecting",t),o.socket=new e.Transport(t),o.socket.onopen=l,o.socket.onclose=p,o.socket.onerror=h,o._connectingTimer=setTimeout(s,o.openTimeout)},connectingExit:function(){clearTimeout(o._connectingTimer),o.socket.onopen=void 0},connectingToWaiting:function(){a()},connectingToImpermanentlyClosing:function(){a()},openPre:function(){o.socket.onmessage=c,o.socket.onerror=h,o.socket.onclose=p,o._openTimer=setTimeout(s,o.connectedTimeout)},openExit:function(){clearTimeout(o._openTimer),o.socket.onmessage=void 0},openToWaiting:function(){a()},openToImpermanentlyClosing:function(){a()},connectedPre:function(e){o.socket_id=e,o.socket.onmessage=f,o.socket.onerror=h,o.socket.onclose=p,n(o),o.connectedAt=(new Date).getTime(),u()},connectedPost:function(){m("connected")},connectedExit:function(){o._activityTimer&&clearTimeout(o._activityTimer),m("disconnected")},impermanentlyClosingPost:function(){o.socket&&(o.socket.onclose=p,o.socket.close())},permanentlyClosingPost:function(){o.socket?(o.socket.onclose=function(){n(o),o._machine.transition("permanentlyClosed")},o.socket.close()):(n(o),o._machine.transition("permanentlyClosed"))},failedPre:function(){m("failed"),e.debug("WebSockets are not available in this browser.")},permanentlyClosedPost:function(){m("disconnected")}})}i.prototype.connect=function(){this._machine.is("failed")||e.Transport?this._machine.is("initialized")?(n(this),this._machine.transition("waiting")):this._machine.is("waiting")&&!0===this.netInfo.isOnLine()?this._machine.transition("connecting"):this._machine.is("permanentlyClosed")&&(n(this),this._machine.transition("waiting")):this._machine.transition("failed")},i.prototype.send=function(e){if(this._machine.is("connected")){var t=this;return setTimeout((function(){t.socket.send(e)}),0),!0}return!1},i.prototype.send_event=function(t,n,i){var r={event:t,data:n};return i&&(r.channel=i),e.debug("Event sent",r),this.send(JSON.stringify(r))},i.prototype.disconnect=function(){this._machine.is("permanentlyClosed")||(this._machine.is("waiting")||this._machine.is("failed")?this._machine.transition("permanentlyClosed"):this._machine.transition("permanentlyClosing"))},e.Util.extend(i.prototype,e.EventsDispatcher.prototype),e.Connection=i}(),function(){e.Channels=function(){this.channels={}},e.Channels.prototype={add:function(t,n){var i=this.find(t);if(i)return i;var r=e.Channel.factory(t,n);return this.channels[t]=r,r},find:function(e){return this.channels[e]},remove:function(e){delete this.channels[e]},disconnect:function(){for(var e in this.channels)this.channels[e].disconnect()}},e.Channel=function(t,n){var i=this;e.EventsDispatcher.call(this,(function(n,i){e.debug("No callbacks on "+t+" for "+n)})),this.pusher=n,this.name=t,this.subscribed=!1,this.bind("pusher_internal:subscription_succeeded",(function(e){i.onSubscriptionSucceeded(e)}))},e.Channel.prototype={init:function(){},disconnect:function(){this.subscribed=!1,this.emit("pusher_internal:disconnected")},onSubscriptionSucceeded:function(e){this.subscribed=!0,this.emit("pusher:subscription_succeeded")},authorize:function(e,t,n){return n(!1,{})},trigger:function(e,t){return this.pusher.send_event(e,t,this.name)}},e.Util.extend(e.Channel.prototype,e.EventsDispatcher.prototype),e.Channel.PrivateChannel={authorize:function(t,n,i){var r=this;return new e.Channel.Authorizer(this,e.channel_auth_transport,n).authorize(t,(function(e,t){e||r.emit("pusher_internal:authorized",t),i(e,t)}))}},e.Channel.PresenceChannel={init:function(){this.members=new t(this)},onSubscriptionSucceeded:function(e){this.subscribed=!0}};var t=function(e){var t=this,n=function(){this._members_map={},this.count=0,this.me=null};n.call(this),e.bind("pusher_internal:authorized",(function(n){var i=JSON.parse(n.channel_data);e.bind("pusher_internal:subscription_succeeded",(function(n){t._members_map=n.presence.hash,t.count=n.presence.count,t.me=t.get(i.user_id),e.emit("pusher:subscription_succeeded",t)}))})),e.bind("pusher_internal:member_added",(function(n){null===t.get(n.user_id)&&t.count++,t._members_map[n.user_id]=n.user_info,e.emit("pusher:member_added",t.get(n.user_id))})),e.bind("pusher_internal:member_removed",(function(n){var i=t.get(n.user_id);i&&(delete t._members_map[n.user_id],t.count--,e.emit("pusher:member_removed",i))})),e.bind("pusher_internal:disconnected",(function(){n.call(t)}))};t.prototype={each:function(e){for(var t in this._members_map)e(this.get(t))},get:function(e){return this._members_map.hasOwnProperty(e)?{id:e,info:this._members_map[e]}:null}},e.Channel.factory=function(t,n){var i=new e.Channel(t,n);return 0===t.indexOf("private-")?e.Util.extend(i,e.Channel.PrivateChannel):0===t.indexOf("presence-")&&(e.Util.extend(i,e.Channel.PrivateChannel),e.Util.extend(i,e.Channel.PresenceChannel)),i.init(),i}}(),e.Channel.Authorizer=function(e,t,n){this.channel=e,this.type=t,this.authOptions=(n||{}).auth||{}},e.Channel.Authorizer.prototype={composeQuery:function(e){var t="&socket_id="+encodeURIComponent(e)+"&channel_name="+encodeURIComponent(this.channel.name);for(var n in this.authOptions.params)t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(this.authOptions.params[n]);return t},authorize:function(t,n){return e.authorizers[this.type].call(this,t,n)}},e.auth_callbacks={},e.authorizers={ajax:function(t,n){var i;for(var r in(i=e.XHR?new e.XHR:window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).open("POST",e.channel_auth_endpoint,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.authOptions.headers)i.setRequestHeader(r,this.authOptions.headers[r]);return i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status){var t,r=!1;try{t=JSON.parse(i.responseText),r=!0}catch(e){n(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+i.responseText)}r&&n(!1,t)}else e.warn("Couldn't get auth info from your webapp",i.status),n(!0,i.status)},i.send(this.composeQuery(t)),i},jsonp:function(t,n){void 0!==this.authOptions.headers&&e.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var i=document.createElement("script");e.auth_callbacks[this.channel.name]=function(e){n(!1,e)};var r="Pusher.auth_callbacks['"+this.channel.name+"']";i.src=e.channel_auth_endpoint+"?callback="+encodeURIComponent(r)+this.composeQuery(t);var o=document.getElementsByTagName("head")[0]||document.documentElement;o.insertBefore(i,o.firstChild)}};var r=function(){function e(e,t){var n=document.getElementsByTagName("head")[0],i=document.createElement("script");i.setAttribute("src",e),i.setAttribute("type","text/javascript"),i.setAttribute("async",!0),function(e,t){document.addEventListener?e.addEventListener("load",t,!1):e.attachEvent("onreadystatechange",(function(){"loaded"!=e.readyState&&"complete"!=e.readyState||t()}))}(i,(function(){t()})),n.appendChild(i)}return function(t,n){for(var i=0,r=0;r<t.length;r++)e(t[r],(function(){t.length==++i&&setTimeout(n,0)}))}}();!function(){n()&&!window.WebSocket&&window.MozWebSocket&&(window.WebSocket=window.MozWebSocket),n()&&window.WebSocket&&(e.Transport=window.WebSocket,e.TransportType="native");var t=(n()&&("http:"==document.location.protocol?e.cdn_http:e.cdn_https))+e.VERSION,i=[];n()&&!window.JSON&&i.push(t+"/json2"+e.dependency_suffix+".js"),n()&&!window.WebSocket&&(window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,i.push(t+"/flashfallback"+e.dependency_suffix+".js"));var o=n()&&window.WebSocket?function(){e.ready()}:function(){window.WebSocket?(e.Transport=window.WebSocket,e.TransportType="flash",window.WEB_SOCKET_SWF_LOCATION="https://s3.amazonaws.com/uploadcare-static/WebSocketMainInsecure.swf",WebSocket.__addTask((function(){e.ready()})),WebSocket.__initialize()):(e.Transport=null,e.TransportType="none",e.ready())},a=function(){var e;e=o,function t(){n()&&(document.body?e():setTimeout(t,0))}()};i.length>0?r(i,a):a()}(),this.Pusher=e}).call(t)})).Pusher,wt={};bt.prototype.constructor=bt;var At=function(e){d(i,e);var t=v(i);function i(){return o(this,i),t.apply(this,arguments)}return s(i,[{key:"subscribe",value:function(e){return this.disconnectTimeout&&(clearTimeout(this.disconnectTimeout),this.disconnectTimeout=null),this.connect(),_(p(i.prototype),"subscribe",this).apply(this,arguments)}},{key:"unsubscribe",value:function(e){var t=this;_(p(i.prototype),"unsubscribe",this).apply(this,arguments),n.default.isEmptyObject(this.channels.channels)&&(this.disconnectTimeout=setTimeout((function(){return t.disconnectTimeout=null,t.disconnect()}),5e3))}}]),i}(bt),kt=function(e){return null==wt[e]&&(wt[e]=new At(e)),wt[e].connect(),wt[e]},xt=function(e){d(i,e);var t=v(i);function i(e){var n,r;if(o(this,i),(n=t.apply(this,arguments)).__url=e,r=H.exec(n.__url)[3].split("/").pop())try{n.fileName=decodeURIComponent(r)}catch(e){n.fileName=r}return n.__notifyApi(),n}return s(i,[{key:"setName",value:function(e){return this.fileName=e,this.__realFileName=e,this.__notifyApi()}},{key:"setIsImage",value:function(e){return this.isImage=e,this.__notifyApi()}},{key:"__startUpload",value:function(){var e,t,i,r,o=this;return t=n.default.Deferred(),r=new St(this.settings),i=new Ct(this.settings),e={pub_key:this.settings.publicKey,signature:this.settings.secureSignature,expire:this.settings.secureExpire,source_url:this.__url,filename:this.__realFileName||"",source:this.sourceInfo.source,store:this.settings.doNotStore?"":"auto",jsonerrors:1},X((function(){if("pending"===o.apiDeferred.state())return le("".concat(o.settings.urlBase,"/from_url/"),"GET",e,{headers:{"X-UC-User-Agent":o.settings._userAgent}}).fail((function(n){return o.settings.debugUploads&&B("Can't start upload from URL.",n.message,e),t.reject(n)})).done((function(e){var a;if("pending"===o.apiDeferred.state())return o.settings.debugUploads&&(B("Start watchers.",e.token),a=setInterval((function(){return B("Still watching.",e.token)}),5e3),t.done((function(){return B("Stop watchers.",e.token)})).always((function(){return clearInterval(a)}))),o.__listenWatcher(t,n.default([r,i])),t.always((function(){return n.default([r,i]).off(o.allEvents),r.stopWatching(),i.stopWatching()})),n.default(r).one(o.allEvents,(function(){if(i.interval)return o.settings.debugUploads&&B("Start using pusher.",e.token),i.stopWatching()})),r.watch(e.token),i.watch(e.token)}))})),t}},{key:"__listenWatcher",value:function(e,t){var i=this;return t.on("progress",(function(t,n){return i.fileSize=n.total,e.notify(n.done/n.total)})).on("success",(function(t,r){return n.default(t.target).trigger("progress",r),i.fileId=r.uuid,i.__handleFileData(r),e.resolve()})).on("error fail",(function(t,n){if(n.error_code){var i=n.error_code,r=n.msg;e.reject({code:i,message:r})}else e.reject(n)}))}}]),i}(gt);xt.prototype.sourceName="url",xt.prototype.allEvents="progress success error fail";var St=function(){function e(t){o(this,e),this.settings=t;try{this.pusher=kt(this.settings.pusherKey)}catch(e){this.pusher=null}}return s(e,[{key:"watch",value:function(e){var t=this;if(this.token=e,this.pusher)return this.pusher.subscribe("task-status-".concat(this.token)).bind_all((function(e,i){return n.default(t).trigger(e,i)}))}},{key:"stopWatching",value:function(){if(this.pusher)return this.pusher.unsubscribe("task-status-".concat(this.token))}}]),e}(),Ct=function(){function e(t){o(this,e),this.settings=t,this.poolUrl="".concat(this.settings.urlBase,"/from_url/status/")}return s(e,[{key:"watch",value:function(e){var t=this;this.token=e;return function e(){return t.interval=setTimeout((function(){t.__updateStatus().done((function(){t.interval&&e()}))}),333),t.interval}()}},{key:"stopWatching",value:function(){return this.interval&&clearTimeout(this.interval),this.interval=null,this.interval}},{key:"__updateStatus",value:function(){var e=this;return le(this.poolUrl,"GET",{token:this.token},{headers:{"X-UC-User-Agent":this.settings._userAgent}}).fail((function(t){return n.default(e).trigger("error",t)})).done((function(t){return n.default(e).trigger(t.status,t)}))}}]),e}(),Tt=function(e){d(n,e);var t=v(n);function n(e){var i,r;return o(this,n),i=t.apply(this,arguments),(r=ne(e))?(i.fileId=r[1],r[2]&&(i.cdnUrlModifiers=r[2])):i.__rejectApi("baddata"),i}return n}(gt);Tt.prototype.sourceName="uploaded";var Ut=function(e){d(n,e);var t=v(n);function n(e){var i;return o(this,n),i=t.apply(this,arguments),e?(i.fileId=e.uuid,i.__handleFileData(e)):i.__rejectApi("deleted"),i}return n}(gt);Ut.prototype.sourceName="uploaded";var Dt={object:_t,input:yt,url:xt,uploaded:Tt,ready:Ut},Pt=function(e,t,n){return jt(e,[t],n)[0]},jt=function(e,t,i){var r,o,a,s,u;for(i=Qe(i||{}),u=[],r=0,a=t.length;r<a;r++)s=t[r],o=void 0,n.default.isArray(s)&&(o=s[1],s=s[0]),u.push(new Dt[e](s,i,o).promise());return u},It=function(e){return e&&e.done&&e.fail&&e.cancel},Ot=function(e,t){return e&&!It(e)&&(e=Pt("uploaded",e,t)),e||null},Et=function(e){return e&&e.files&&e.promise},Rt=[].indexOf,zt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o(this,e),this.onAdd=n.default.Callbacks(),this.onRemove=n.default.Callbacks(),this.onSort=n.default.Callbacks(),this.onReplace=n.default.Callbacks(),this.__items=[],i||this.init(t)}return s(e,[{key:"init",value:function(e){var t,n,i;for(n=0,i=e.length;n<i;n++)t=e[n],this.add(t)}},{key:"add",value:function(e){return this.__add(e,this.__items.length)}},{key:"__add",value:function(e,t){return this.__items.splice(t,0,e),this.onAdd.fire(e,t)}},{key:"remove",value:function(e){var t;if(-1!==(t=n.default.inArray(e,this.__items)))return this.__remove(e,t)}},{key:"__remove",value:function(e,t){return this.__items.splice(t,1),this.onRemove.fire(e,t)}},{key:"clear",value:function(){var e,t,n,i,r,o;for(n=this.get(),this.__items.length=0,o=[],e=i=0,r=n.length;i<r;e=++i)t=n[e],o.push(this.onRemove.fire(t,e));return o}},{key:"replace",value:function(e,t){var i;if(e!==t&&-1!==(i=n.default.inArray(e,this.__items)))return this.__replace(e,t,i)}},{key:"__replace",value:function(e,t,n){return this.__items[n]=t,this.onReplace.fire(e,t,n)}},{key:"sort",value:function(e){return this.__items.sort(e),this.onSort.fire()}},{key:"get",value:function(e){return null!=e?this.__items[e]:this.__items.slice(0)}},{key:"length",value:function(){return this.__items.length}}]),e}(),Ft=function(e){d(n,e);var t=v(n);function n(){return o(this,n),t.apply(this,arguments)}return s(n,[{key:"add",value:function(e){if(!(Rt.call(this.__items,e)>=0))return _(p(n.prototype),"add",this).apply(this,arguments)}},{key:"__replace",value:function(e,t,i){return Rt.call(this.__items,t)>=0?this.remove(e):_(p(n.prototype),"__replace",this).apply(this,arguments)}}]),n}(zt),Lt=function(e){d(i,e);var t=v(i);function i(){var e,r;return o(this,i),(r=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments),[!0]))).anyDoneList=n.default.Callbacks(),r.anyFailList=n.default.Callbacks(),r.anyProgressList=n.default.Callbacks(),r._thenArgs=null,r.anyProgressList.add((function(e,t){return n.default(e).data("lastProgress",t)})),_((e=m(r),p(i.prototype)),"init",e).call(e,arguments[0]),r}return s(i,[{key:"onAnyDone",value:function(e){var t,n,i,r,o;for(this.anyDoneList.add(e),o=[],n=0,i=(r=this.__items).length;n<i;n++)"resolved"===(t=r[n]).state()?o.push(t.done((function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e.apply(void 0,[t].concat(i))}))):o.push(void 0);return o}},{key:"onAnyFail",value:function(e){var t,n,i,r,o;for(this.anyFailList.add(e),o=[],n=0,i=(r=this.__items).length;n<i;n++)"rejected"===(t=r[n]).state()?o.push(t.fail((function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e.apply(void 0,[t].concat(i))}))):o.push(void 0);return o}},{key:"onAnyProgress",value:function(e){var t,i,r,o,a;for(this.anyProgressList.add(e),a=[],i=0,r=(o=this.__items).length;i<r;i++)t=o[i],a.push(e(t,n.default(t).data("lastProgress")));return a}},{key:"lastProgresses",value:function(){var e,t,i,r,o;for(o=[],t=0,i=(r=this.__items).length;t<i;t++)e=r[t],o.push(n.default(e).data("lastProgress"));return o}},{key:"add",value:function(e){if(e&&e.then){var t;if(this._thenArgs)e=(t=e).then.apply(t,b(this._thenArgs));return _(p(i.prototype),"add",this).call(this,e),this.__watchItem(e)}}},{key:"__replace",value:function(e,t,n){return t&&t.then?(_(p(i.prototype),"__replace",this).apply(this,arguments),this.__watchItem(t)):this.remove(e)}},{key:"__watchItem",value:function(e){var t=this,n=function(n){return function(){if(Rt.call(t.__items,e)>=0){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return n.fire.apply(n,[e].concat(r))}}};return e.then(n(this.anyDoneList),n(this.anyFailList),n(this.anyProgressList))}},{key:"autoThen",value:function(){var e,t,n,i,r,o;if(this._thenArgs)throw new Error("CollectionOfPromises.then() could be used only once");for(var a=arguments.length,s=new Array(a),u=0;u<a;u++)s[u]=arguments[u];for(this._thenArgs=s,o=[],e=n=0,i=(r=this.__items).length;n<i;e=++n){var l;t=r[e],o.push(this.__replace(t,(l=t).then.apply(l,b(this._thenArgs)),e))}return o}}]),i}(Ft),Mt={en:{pluralize:function(e){return 1===e?"one":"other"},translations:{uploading:"Uploading... Please wait.",loadingInfo:"Loading info...",errors:{default:"Error",baddata:"Incorrect value",size:"File too big",upload:"Can’t upload",user:"Upload canceled",info:"Can’t load info",image:"Only images allowed",createGroup:"Can’t create file group",deleted:"File was deleted"},draghere:"Drop a file here",file:{one:"%1 file",other:"%1 files"},buttons:{cancel:"Cancel",remove:"Remove",choose:{files:{one:"Choose a file",other:"Choose files"},images:{one:"Choose an image",other:"Choose images"}}},dialog:{close:"Close",openMenu:"Open menu",done:"Done",showFiles:"Show files",tabs:{names:{"empty-pubkey":"Welcome",preview:"Preview",file:"Local Files",url:"Direct Link",camera:"Camera",facebook:"Facebook",dropbox:"Dropbox",gdrive:"Google Drive",gphotos:"Google Photos",instagram:"Instagram",vk:"VK",evernote:"Evernote",box:"Box",onedrive:"OneDrive",flickr:"Flickr",huddle:"Huddle"},file:{drag:"drag & drop<br>any files",nodrop:"Upload files from your&nbsp;computer",cloudsTip:"Cloud storages<br>and social networks",or:"or",button:"Choose a local file",also:"or choose from"},url:{title:"Files from the Web",line1:"Grab any file off the web.",line2:"Just provide the link.",input:"Paste your link here...",button:"Upload"},camera:{title:"File from web camera",capture:"Take a photo",mirror:"Mirror",startRecord:"Record a video",stopRecord:"Stop",cancelRecord:"Cancel",retry:"Request permissions again",pleaseAllow:{title:"Please allow access to your camera",text:"You have been prompted to allow camera access from this site.<br>In order to take pictures with your camera you must approve this request."},notFound:{title:"No camera detected",text:"Looks like you have no camera connected to this device."}},preview:{unknownName:"unknown",change:"Cancel",back:"Back",done:"Add",unknown:{title:"Uploading... Please wait for a preview.",done:"Skip preview and accept"},regular:{title:"Add this file?",line1:"You are about to add the file above.",line2:"Please confirm."},image:{title:"Add this image?",change:"Cancel"},crop:{title:"Crop and add this image",done:"Done",free:"free"},video:{title:"Add this video?",change:"Cancel"},error:{default:{title:"Oops!",text:"Something went wrong during the upload.",back:"Please try again"},image:{title:"Only image files are accepted.",text:"Please try again with another file.",back:"Choose image"},size:{title:"The file you selected exceeds the limit.",text:"Please try again with another file."},loadImage:{title:"Error",text:"Can’t load image"}},multiple:{title:"You’ve chosen %files%.",question:"Add %files%?",tooManyFiles:"You’ve chosen too many files. %max% is maximum.",tooFewFiles:"You’ve chosen %files%. At least %min% required.",clear:"Remove all",done:"Add",file:{preview:"Preview %file%",remove:"Remove %file%"}}}},footer:{text:"powered by",link:"uploadcare"}},serverErrors:{AccountBlockedError:"Administrator's account has been blocked. Please, contact support.",AccountUnpaidError:"Administrator's account has been blocked. Please, contact support.",AccountLimitsExceededError:"Administrator's account has reached its limits. Please, contact support.",FileSizeLimitExceededError:"File is too large.",MultipartFileSizeLimitExceededError:"File is too large.",FileTypeForbiddenOnCurrentPlanError:"Uploading of these files types is not allowed.",DownloadFileSizeLimitExceededError:"Downloaded file is too big."}}}},Bt=null,Nt={translations:Object.keys(Mt).reduce((function(e,t){return e[t]=Mt[t].translations,e}),{}),pluralize:Object.keys(Mt).reduce((function(e,t){return e[t]=Mt[t].pluralize,e}),{}),rebuild:function(e){return Bt=null,Kt(e)},t:function(e,t){var n,i,r;return n=Kt(),null==(r=qt(e,n.translations))&&n.lang!==Wt.lang&&(r=qt(e,(n=Wt).translations)),null!=t&&(r=null!=n.pluralize?(null!=(i=r[n.pluralize(t)])?i.replace("%1",t):void 0)||t:""),r||""}},Wt={lang:"en",translations:Mt.en.translations,pluralize:Mt.en.pluralize},Kt=function(e){if(!Bt){var t=Qe(e),i=t.locale||Wt.lang,r=n.default.extend(!0,{},Nt.translations[i],t.localeTranslations),o=n.default.isFunction(t.localePluralize)?t.localePluralize:Nt.pluralize[i];Bt={lang:i,translations:r,pluralize:o}}return Bt},qt=function(e,t){for(var n=e.split("."),i=0,r=n.length;i<r;i++){var o=n[i];if(null==t)return null;t=t[o]}return t},Gt=function(){function e(t,i){var r,a=this;o(this,e),this.__uuid=null,this.settings=Qe(i),this.__fileColl=new Lt(t),this.__allFilesDf=n.default.when.apply(n.default,b(this.files())),this.__fileInfosDf=(t=function(){var e,t,i,o;for(o=[],e=0,t=(i=this.files()).length;e<t;e++)r=i[e],o.push(r.then(null,(function(e,t){return n.default.when(t)})));return o}.call(a),n.default.when.apply(n.default,b(t))),this.__createGroupDf=n.default.Deferred(),this.__initApiDeferred()}return s(e,[{key:"files",value:function(){return this.__fileColl.get()}},{key:"__save",value:function(){var e=this;if(!this.__saved)return this.__saved=!0,this.__allFilesDf.done((function(){return e.__createGroup().done((function(t){return e.__uuid=t.id,e.__buildInfo((function(t){return e.settings.imagesOnly&&!t.isImage?e.__createGroupDf.reject("image",t):e.__createGroupDf.resolve(t)}))})).fail((function(t){return e.__createGroupDf.reject("createGroup",t)}))}))}},{key:"promise",value:function(){return this.__save(),this.__apiDf.promise()}},{key:"__initApiDeferred",value:function(){var e,t,i,r=this;return this.__apiDf=n.default.Deferred(),this.__progressState="uploading",t=function(e){return r.__buildInfo((function(t){return r.__apiDf.reject(e,t)}))},i=function(e){return r.__apiDf.resolve(e)},(e=function(){return r.__apiDf.notify(r.__progressInfo())})(),this.__fileColl.onAnyProgress(e),this.__allFilesDf.done((function(){return r.__progressState="uploaded",e()})).fail(t),this.__createGroupDf.done((function(t){return r.__progressState="ready",e(),i(t)})).fail(t)}},{key:"__progressInfo",value:function(){var e,t,n,i,r;for(n=0,e=0,t=(r=this.__fileColl.lastProgresses()).length;e<t;e++)n+=((null!=(i=r[e])?i.progress:void 0)||0)/r.length;return{state:this.__progressState,uploadProgress:n,progress:"ready"===this.__progressState?1:.9*n}}},{key:"__buildInfo",value:function(e){var t;return t={uuid:this.__uuid,cdnUrl:this.__uuid?"".concat(this.settings.cdnBase,"/").concat(this.__uuid,"/"):null,name:Nt.t("file",this.__fileColl.length()),count:this.__fileColl.length(),size:0,isImage:!0,isStored:!0},this.__fileInfosDf.done((function(){for(var n,i,r,o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];for(i=0,r=a.length;i<r;i++)n=a[i],t.size+=n.size,n.isImage||(t.isImage=!1),n.isStored||(t.isStored=!1);return e(t)}))}},{key:"__createGroup",value:function(){var e,t=this;return e=n.default.Deferred(),this.__fileColl.length()?this.__fileInfosDf.done((function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o;return le("".concat(t.settings.urlBase,"/group/?jsonerrors=1"),"POST",{pub_key:t.settings.publicKey,signature:t.settings.secureSignature,expire:t.settings.secureExpire,files:function(){var e,t,n;for(n=[],e=0,t=i.length;e<t;e++)o=i[e],n.push("/".concat(o.uuid,"/").concat(o.cdnUrlModifiers||""));return n}()},{headers:{"X-UC-User-Agent":t.settings._userAgent}}).fail((function(n){return t.settings.debugUploads&&M("Can't create group.",t.settings.publicKey,n.message),e.reject(n)})).done(e.resolve)})):e.reject(),e.promise()}},{key:"api",value:function(){return this.__api||(this.__api=Y(this,["promise","files"])),this.__api}}]),e}(),Xt=function(e){d(n,e);var t=v(n);function n(e,i){var r,a;return o(this,n),a=jt("ready",e.files,i),(r=t.call(this,a,i)).__data=e,r}return s(n,[{key:"__createGroup",value:function(){return V(this.__data)}}]),n}(Gt),Jt=function(){var e,t,n,i,r,o,a,s,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],l=arguments.length>1?arguments[1]:void 0;for(t=[],i=0,o=u.length;i<o;i++)if(n=u[i],It(n))t.push(n);else if(Et(n))for(r=0,a=(s=n.files()).length;r<a;r++)e=s[r],t.push(e);return new Gt(t,l).api()},Vt=function(e,t){var i,r;return t=Qe(t),i=n.default.Deferred(),(r=ee.exec(e))?le("".concat(t.urlBase,"/group/info/"),"GET",{jsonerrors:1,pub_key:t.publicKey,group_id:r[0]},{headers:{"X-UC-User-Agent":t._userAgent}}).fail((function(e){return t.debugUploads&&M("Can't load group info. Probably removed.",r[0],t.publicKey,e.message),i.reject(e)})).done((function(e){var n;return n=new Xt(e,t),i.resolve(n.api())})):i.reject(),i.promise()},Yt={};k()&&n.default(window).on("message",(function(e){var t,n,i,r,o,a,s=e.originalEvent;try{r=JSON.parse(s.data)}catch(e){return}if((null!=r?r.type:void 0)&&r.type in Yt){for(a=[],t=0,i=(o=Yt[r.type]).length;t<i;t++)n=o[t],s.source===n[0]?a.push(n[1](r)):a.push(void 0);return a}}));var $t,Qt=new Ze,Ht={version:"3.15.0",jQuery:n.default,utils:{abilities:{fileAPI:C,sendFileAPI:T,dragAndDrop:U,canvas:D,fileDragAndDrop:P,iOSVersion:j,Blob:R,URL:F,FileReader:L},Collection:zt,UniqCollection:Ft,CollectionOfPromises:Lt,imageLoader:tt,videoLoader:function(e){var t=n.default.Deferred();return n.default("<video></video>").on("loadeddata",t.resolve).on("error",t.reject).attr("src",e).get(0).load(),t.promise()},log:M,debug:B,warn:N,warnOnce:K,registerMessage:function(e,t,n){return e in Yt||(Yt[e]=[]),Yt[e].push([t,n])},unregisterMessage:function(e,t){if(e in Yt)return Yt[e]=n.default.grep(Yt[e],(function(e){return e[0]!==t})),Yt[e]},unique:G,defer:X,gcd:function(e,t){for(var n;t;)n=e%t,e=t,t=n;return e},once:J,wrapToPromise:V,then:function(e,t,i,r){var o,a;return a=n.default.Deferred(),o=function(e,t){return e&&t?function(){return t.call(this,e.apply(this,arguments))}:e||t},e.then(o(t,a.resolve),o(i,a.reject),o(r,a.notify)),a.promise()},bindAll:Y,upperCase:$,publicCallbacks:function(e){var t;return(t=e.add).add=e.add,t.remove=e.remove,t},uuid:Q,splitUrlRegex:H,uuidRegex:Z,groupIdRegex:ee,cdnUrlRegex:te,splitCdnUrl:ne,escapeRegExp:ie,globRegexp:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"i";return t=n.default.map(e.split("*"),ie),new RegExp("^"+t.join(".+")+"$",i)},normalizeUrl:re,fitText:function(e,t){if(e.length>t){var n=Math.ceil((t-3)/2),i=Math.floor((t-3)/2);return e.slice(0,n)+"..."+e.slice(-i)}return e},fitSizeInCdnLimit:function(e){return oe(e,[2048,2048])},fitSize:oe,applyCropCoordsToInfo:function(e,t,i,r){var o,a,s,u,l,c,f;if(c=r.width,a=r.height,u=t.preferedSize,s="",(f=c===i[0]&&a===i[1])||(s+="-/crop/".concat(c,"x").concat(a,"/").concat(r.left,",").concat(r.top,"/")),o=t.downscale&&(c>u[0]||a>u[1]),l=t.upscale&&(c<u[0]||a<u[1]),o||l){var d=y(u,2);r.sw=d[0],r.sh=d[1],s+="-/resize/".concat(u.join("x"),"/")}else f||(s+="-/preview/");return(e=n.default.extend({},e)).cdnUrlModifiers=s,e.cdnUrl="".concat(e.originalUrl).concat(s||""),e.crop=r,e},fileInput:function(e,t,i){var r,o,a;return o=null,""===(r=t.inputAcceptTypes)&&(r=t.imagesOnly?ae:null),(a=function(){return o=(t.multiple?n.default('<input type="file" multiple>'):n.default('<input type="file">')).attr("accept",r).css({position:"absolute",top:0,opacity:0,margin:0,padding:0,width:"auto",height:"auto",cursor:e.css("cursor")}).on("change",(function(){return i(this),n.default(this).hide(),a()})),e.append(o)})(),e.css({position:"relative",overflow:"hidden"}).mousemove((function(e){var t,i,r,a=n.default(this).offset();return t=a.left,i=a.top,r=o.width(),o.css({left:e.pageX-t-r+10,top:e.pageY-i-10})}))},fileSelectDialog:function(e,t,i){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return""===(r=t.inputAcceptTypes)&&(r=t.imagesOnly?ae:null),n.default(t.multiple?'<input type="file" multiple>':'<input type="file">').attr("accept",r).attr(o).css({position:"fixed",bottom:0,opacity:0}).on("change",(function(){return i(this),n.default(this).remove()})).appendTo(e).focus().click().hide()},fileSizeLabels:se,readableFileSize:function(e){var t,n,i,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(e=parseInt(e,10),isNaN(e))return o;for(t=2,i=0,r=1e3-5*Math.pow(10,2-Math.max(t,3));e>r&&i<se.length-1;)i++,e/=1024;return e+=1e-15,n=Math.max(0,t-Math.floor(e).toFixed(0).length),e=Number(e.toFixed(n)),"".concat(a).concat(e," ").concat(se[i]).concat(s)},ajaxDefaults:ue,jsonp:le,canvasToBlob:ce,taskRunner:fe,fixedPipe:pe,isFile:It,valueToFile:Ot,image:{shrinkFile:ut,shrinkImage:ot,drawFileToCanvas:function(e,t,i,r,o){var a,s;return a=n.default.Deferred(),F?((s=tt(F.createObjectURL(e))).always((function(e){return F.revokeObjectURL(e.src)})),s.fail((function(){return a.reject("not image")})),s.done((function(s){return a.always((function(){s.src="//:0"})),o&&s.width*s.height>o?a.reject("max source"):n.default.when(ft(e),nt()).always((function(e,n){var o=n?1:pt(e)||1,u=o>4,l=u?[s.height,s.width]:[s.width,s.height],c=y(oe(l,[t,i]),2),f=c[0],d=c[1],p=[[1,0,0,1,0,0],[-1,0,0,1,f,0],[-1,0,0,-1,f,d],[1,0,0,-1,0,d],[0,1,1,0,0,0],[0,1,-1,0,f,0],[0,-1,-1,0,f,d],[0,-1,1,0,0,d]][o-1];if(!p)return a.reject("bad image");var h=document.createElement("canvas");h.width=f,h.height=d;var m=h.getContext("2d");if(m.transform.apply(m,p),u){var g=[d,f];f=g[0],d=g[1]}return r&&(m.fillStyle=r,m.fillRect(0,0,f,d)),m.drawImage(s,0,0,f,d),a.resolve(h,l)}))})),a.promise()):a.reject("support")},readJpegChunks:lt,replaceJpegChunk:ct,getExif:ft,parseExifOrientation:pt,hasTransparency:mt},pusher:{getPusher:kt},isFileGroup:Et,valueToGroup:function(e,t){var i,r;if(e)if(n.default.isArray(e))i=function(){var n,i,o;for(o=[],n=0,i=e.length;n<i;n++)r=e[n],o.push(Ot(r,t));return o}(),e=Jt(i,t);else if(!Et(e))return Vt(e,t);return V(e||null)},isFileGroupsEqual:function(e,t){var n,i,r,o,a;if(e===t)return!0;if(!Et(e)||!Et(t))return!1;if(n=e.files(),i=t.files(),n.length!==i.length)return!1;for(r=o=0,a=n.length;o<a;r=++o)if(n[r]!==i[r])return!1;return!0}},settings:{globals:Ye,build:Qe,common:$e,waitForSettings:He,CssCollector:Ze},locale:Nt,tabsCss:Qt,files:{BaseFile:gt,ObjectFile:_t,InputFile:yt,UrlFile:xt,UploadedFile:Tt,ReadyFile:Ut,FileGroup:Gt,SavedFileGroup:Xt},Pusher:bt,FileGroup:Jt,loadFileGroup:Vt,fileFrom:Pt,filesFrom:jt,__exports:{},namespace:function(e,t){var n=Ht;if(e)for(var i=e.split("."),r=0,o=i.length;r<o;r++){var a=i[r];n[a]||(n[a]={}),n=n[a]}return t(n)},expose:function(e,t){for(var n=e.split("."),i=n.pop(),r=Ht.__exports,o=Ht,a=0,s=n.length;a<s;a++){var u=n[a];r[u]||(r[u]={}),r=r[u],o=null!=o?o[u]:void 0}r[i]=t||o[i]}};return{plugin:($t=Ht,function(e){return e($t)}),version:"3.15.0",jQuery:n.default,defaults:f(f({},Ie),{},{allTabs:Be.tabs.all}),globals:$e,start:$e,fileFrom:Pt,filesFrom:jt,FileGroup:Jt,loadFileGroup:Vt,locales:["en"]}}));
